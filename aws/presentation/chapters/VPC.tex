\section{Virtual Private Cloud}

\begin{frame}
	\frametitle{Virtual Private Cloud (VPC)}
	\begin{itemize}
		\item VPCs são isoladas entre si, mas podem ser configuradas para se comunicarem
		\item Cada região tem uma VPC padrão, mas é recomendada criar sua própria VPC para o ambiente de produção
		\item Dentro de uma VPC é possível criar uma subnet
		\item As subnets são aplicadas em AZs (Zonas de disponibilidade)
		\item Subnet:
			\begin{itemize}
				\item Pública: Pode ser acessada remotamente por qualquer lugar
				\item Privada: Só vai ser acessível por dentro da AWS
			\end{itemize}
		\item \textbf{VPC wizard} tem algumas configurações pré-definidas de VPC
		\item Lembrar de verificar e configurar:
		\begin{itemize}
			\item DHCP options set
			\item DNS resolution
			\item DNS hostname
		\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{NAT Gateway}
	\begin{itemize}
		\item Instâncias dentro de subnets privadas podem conectar com serviços fora da VPC, mas instâncias de fora não podem iniciar ocnexões com essas instâncias
			\begin{itemize}
				\item Public: Instâncias em subnets privadas podem conectar com a internet
				\item Private: Instâncias em subnets privadas podem conectar com outros VPCs
			\end{itemize}
		\item Cobrança por hora de uso e quantidade em GBs de dados processados
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Internet Gateway}
	\begin{itemize}
		\item Permite a comunicação do seu VPC com a internet
		\item Libera a entrada e a saída de determinado \textbf{Route Table}
		\item Não tem custo
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Route table}
	\begin{itemize}
		\item Associa as \textbf{subnets}
		\item Se a \textbf{Route table} não tiver uma rota default ela não está pública
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Security Groups X NetworkACL}
	\begin{itemize}
		\item \textbf{Securty Groups}
		\begin{itemize}
			\item Opera no nível de instância (Primeira camada de defesa)
			\item Apenas regras de liberação
			\item Stateful: o tráfego de retorno é automaticamente permitido, independentemente de quaisquer regras
			\item Aplica-se a uma instância somente quando especificado o grupo de segurança
		\end{itemize}
		\item \textbf{NetworkACL}
		\begin{itemize}
			\item Regra de segurança da rede (Como se fosse um \textit{firewall})
			\item Regras de liberação e negação
			\item Stateless: o tráfego de retorno deve ser explicitamente permitido pelas regras
			\item Aplica a todas as instâncias nas sub-redes
		\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{NetworkACL}
	\begin{itemize}
		\item Cada regra vai ter uma prioridade
		\item É bom deixar um espaço entre cada regra para possíveis regras futuras (Ex: deixar 10 espaços entre cada regra)
		\item \textbf{OBS}: É bom liberar portas efêmeras (1024-65535). São usadas para comunicações de saída através do protocolo de rede TCP/IP
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Network Optimization}
	\begin{itemize}
		\item Quantas VPCs eu preciso?
			\begin{itemize}
				\item Depende de quanto achar necessário para separar a aplicação
				\item É comum uma VPC Para AWS Network Firewall ou Firewall com Gateway Load Balancer.
				\item Talvez VPCs para Ingress e Egress centralizados
			\end{itemize}
		\item Tamanho da VPC
			\begin{itemize}
				\item Evitar alocar /16 endereços IP padrão para todas as VPCs
				\item Alguns recursos precisam de IPs livres (Load balancer precisa de 8 IPs livres)
				\item É possível usar o IPAM (VPC IP Address Manager)\footnote{\href{Network Address Management and Auditing at Scale with Amazon VPC IP Address Manager}{https://aws.amazon.com/blogs/aws/network-address-management-and-auditing-at-scale-with-amazon-vpc-ip-address-manager/}} para gerenciar os IPs nas redes
				\item OBS: É possível usar o cloudWatch junto com o IPAM para verificar se os endereços IPs estão acabando
			\end{itemize}
		\item Quantas subnets por VPC?
			\begin{itemize}
				\item Pelo menos 1 subnet por VPC
				\item Caso a aplicação esteja em várias AZs, é recomendado pelo menos uma subnet por AZ
				\item OBS: Quando uma subnet é colocada em uma AZ não é possível mudar
			\end{itemize}
		\item Comparilhar VPC ou criar uma VPC nova para o workload?
			\begin{itemize}
				\item Mesmo que diferentes times trabalhem em diferentes contas da AWS, não significa que precisam necessariamente usar diferentes VPCs
				\item VPC Sharing\footnote{\href{VPC Sharing}{https://aws.amazon.com/blogs/networking-and-content-delivery/vpc-sharing-a-new-approach-to-multiple-accounts-and-vpc-management/}} permite compartilhar VPCs com outras contas AWS
				\item \href{VPC Sharing Best Pratices}{https://aws.amazon.com/blogs/networking-and-content-delivery/vpc-sharing-key-considerations-and-best-practices/}
			\end{itemize}
	\end{itemize}
\end{frame}

